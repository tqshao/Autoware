<?xml version="1.0"?>
<launch>
  <!-- teliop TODO make make it possible to initialize with other config files for vehicle and obstacle position-->
  <!-- TODO fix gazebo and RViz views on hmmwv -->
  <!-- TODO fix display issue on the tires -->
  <!-- TODO add speed of obstacles -->
  <!-- TODO add speed multiple obstacles -->
  <!-- TODO use the robot name parametrically in all files-->
  <!-- TODO add in an option to update the state of the vehicle based off of /state/ parameter-->
  <!-- TODO add in an option to pause the simulation before it starts -->

  <arg name="name" default="hmmwv"/>

  <!--  ************** Global Parameters ***************  -->
  <!--param name="/use_sim_time" value="true"/-->
  <rosparam command="load" file="$(find mavs_gazebo)/config/global_params.yaml" />

  <!-- start gazebo and load the world -->
  <include file="$(find mavs_gazebo)/launch/world.launch" />

  <!-- spawn obstacles -->
  <param command="$(find xacro)/xacro --inorder $(find mavs_description)/urdf/obstacles.urdf.xacro " name="obstacles" />
  <node args="-urdf -param obstacles -model obstacles" name="spawn_obstacles" output="screen" pkg="gazebo_ros" respawn="false" type="spawn_model" />

  <!-- spawn robot into Gazebo -->
  <param name="robot_description" command="$(find xacro)/xacro --inorder $(find mavs_gazebo)/urdf/mavs.urdf.xacro" />
  <node name="spawn_urdf" pkg="gazebo_ros" type="spawn_model" args="-param robot_description -urdf -model hmmwv"/>

  <node name="move" pkg="mavs_gazebo" type="move_hmmwv.jl" output="screen"/>


  <!-- Convert PointCloud2 to PointCloud1 -->
  <node pkg="point_cloud_converter" name="point_cloud_converter" type="point_cloud_converter_node" >
    <remap from="points2_in" to="/lidar_points"/>
    <remap from="points_out" to="/pcl" />
		<!--
		<remap from="points2_in" to="velodyne_points"/>
		<remap from="points_out" to="velodyne_points" />
		-->
  </node>

  <arg name="frame_id" default="velodyne_top_link" />
  <arg name="manager" default="$(arg frame_id)_nodelet_manager" />

  <!-- LiDAR data processing -->
  <!-- TODO update obstacle detector min max based off of senario, currently this is hardcoded in-->
  <include file="$(find obstacle_detector)/launch/nodelets_test.launch">
    <arg name="frame_id" value="$(arg frame_id)" />
    <arg name="manager" value="$(arg manager)" />
  </include>

</launch>

